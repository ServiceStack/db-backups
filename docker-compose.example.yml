version: '3.8'

services:
  # Example PostgreSQL database
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_DB: myapp
      POSTGRES_USER: myapp
      POSTGRES_PASSWORD: secret
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - app_network
    restart: unless-stopped

  # Example MySQL database
  mysql:
    image: mysql:8
    environment:
      MYSQL_DATABASE: users
      MYSQL_USER: users
      MYSQL_PASSWORD: secret
      MYSQL_ROOT_PASSWORD: rootsecret
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - app_network
    restart: unless-stopped

  # DB Backup Web App
  db-backup:
    build: .
    # Or use pre-built image:
    # image: db-backup-app:latest
    ports:
      - "3000:3000"
    environment:
      # Required: Encryption key for storing passwords (min 32 characters)
      - ENCRYPTION_KEY=${ENCRYPTION_KEY:-change-this-to-a-secure-32-character-key}

      # Optional: S3 Configuration
      - S3_REGION=${S3_REGION:-us-east-1}
      - S3_BUCKET=${S3_BUCKET}
      - S3_ACCESS_KEY_ID=${S3_ACCESS_KEY_ID}
      - S3_SECRET_ACCESS_KEY=${S3_SECRET_ACCESS_KEY}
      # - S3_ENDPOINT=  # For S3-compatible services like MinIO

      # Optional: Application Settings
      - AUTO_DISCOVER=false
      - TZ=UTC
      - LOG_LEVEL=info
      - MAX_BACKUP_RETENTION_DAYS=365
      - BACKUP_STORAGE_PATH=/app/data/backups
      - DATABASE_PATH=/app/data/db/app.db

      # Optional: Server Settings
      - PORT=3000
      - HOSTNAME=0.0.0.0
    volumes:
      # Persistent storage for database and backups
      - backup_data:/app/data
    networks:
      - app_network
    depends_on:
      - postgres
      - mysql
    restart: unless-stopped

networks:
  app_network:
    driver: bridge

volumes:
  postgres_data:
  mysql_data:
  backup_data:
